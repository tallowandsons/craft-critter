{% import '_includes/forms' as forms %}
{% from 'critter/macros' import configWarning %}

{{ forms.lightswitchField({
    label: "Auto Render Enabled"|t(pluginHandle),
    instructions: "Enable or disable automatic rendering of critical CSS on site requests"|t(pluginHandle),
    warning: config.autoRenderEnabled is defined ? configWarning('autoRenderEnabled'),
    name: 'settings[autoRenderEnabled]',
    on: settings.autoRenderEnabled,
    disabled: readOnly,
}) }}

{{ forms.editableTableField({
    label: "Style Tag Attributes"|t(pluginHandle),
    instructions:  "Define attributes to be added to the critical css style tag rendered by the plugin"|t(pluginHandle),
    warning: (config.styleTagAttributes is defined ? configWarning('styleTagAttributes')),
    name: 'settings[styleTagAttributes]',
    cols: {
        enabled: {
            type: 'lightswitch',
            value: true,
            thin: true,
        },
        key: {
            type: 'singleline',
            heading: 'Key'|t(pluginHandle),
            placeholder: "Enter a key"|t(pluginHandle),
            code: true,
        },
        value: {
            type: 'singleline',
            heading: 'Value'|t(pluginHandle),
            placeholder: "Enter a value"|t(pluginHandle),
            code: true,
        },
    },
    rows: settings.styleTagAttributes,
    addRowLabel: "Add attribute"|t(pluginHandle),
    allowAdd: true,
    allowDelete: true,
    allowReorder: true,
    disabled: readOnly,
}) }}

{{ forms.editableTableField({
    label: "Unique Query Parameters"|t(pluginHandle),
    instructions:  "Requests with these query parameters will be treated as unique pages, so will have separate critical CSS"|t(pluginHandle),
    warning: (config.uniqueQueryParams is defined ? configWarning('uniqueQueryParams')),
    name: 'settings[uniqueQueryParams]',
    cols: {
        enabled: {
            type: 'lightswitch',
            value: true,
            thin: true,
        },
        param: {
            type: 'singleline',
            heading: 'Parameter'|t(pluginHandle),
            placeholder: "Enter a parameter"|t(pluginHandle),
            code: true,
        },
    },
    rows: settings.uniqueQueryParams,
    addRowLabel: "Add parameter"|t(pluginHandle),
    allowAdd: true,
    allowDelete: true,
    allowReorder: true,
    disabled: readOnly,
}) }}

{{ forms.autosuggestField({
    label: "Base URL Override"|t(craft.critter.pluginHandle),
    instructions: "An optional replacement base URL for generating critical CSS. This can be useful for testing or staging environments."|t(craft.critter.pluginHandle),
    warning: config.baseUrlOverride is defined ? configWarning('baseUrlOverride') : null,
    suggestEnvVars: true,
    suggestAliases: true,
    name: 'settings[baseUrlOverride]',
    value: settings.baseUrlOverride ?? null,
    required: false,
    disabled: readOnly,
    code: true
}) }}

{{ forms.selectField({
    label: "Default Mode"|t(pluginHandle),
    instructions: "The default mode to use when generating critical CSS."|t(pluginHandle),
    warning: (config.defaultMode is defined ? configWarning('defaultMode')),
    name: 'settings[defaultMode]',
    options: defaultModeOptions,
    value: settings.defaultMode,
    disabled: readOnly,
}) }}

{{ forms.textField({
    label: "Max Retries"|t(pluginHandle),
    instructions: "The maximum number of times to retry failed jobs (mutex locks, network issues, etc.)."|t(pluginHandle),
    warning: config.maxRetries is defined ? configWarning('maxRetries') : null,
    name: 'settings[maxRetries]',
    value: settings.maxRetries ?? 3,
    type: 'number',
    min: 0,
    max: 10,
    disabled: readOnly,
}) }}

{{ forms.textField({
    label: "Retry Base Delay"|t(pluginHandle),
    instructions: "The base delay in seconds for exponential backoff between retries."|t(pluginHandle),
    warning: config.retryBaseDelay is defined ? configWarning('retryBaseDelay') : null,
    name: 'settings[retryBaseDelay]',
    value: settings.retryBaseDelay ?? 30,
    type: 'number',
    min: 1,
    max: 300,
    disabled: readOnly,
}) }}
